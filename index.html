<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Remove Liquidity DApp (Fixed Web3Modal)</title>

  <!-- 1) Ethers.js UMD -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <!-- 2) Coinbase Wallet SDK -->
  <script src="https://unpkg.com/@coinbase/wallet-sdk@3.6.0/dist/CoinbaseWalletSDK.min.js"></script>

  <!-- 3) Web3Modal UMD -->
  <script src="https://unpkg.com/web3modal@1.9.4/dist/index.umd.js"></script>

  <style>
    body { font-family: sans-serif; max-width: 500px; margin: 2rem auto; }
    input, button { width: 100%; padding: .5rem; margin: .5rem 0; }
    #status, #txHash { white-space: pre-wrap; margin: .5rem 0; }
    #txHash { word-break: break-all; }
  </style>
</head>
<body>

  <h1>Remove Liquidity</h1>
  <button id="connectBtn">Connect Wallet</button>
  <div id="status">Wallet not connected</div>

  <label>Amount of LP tokens to remove:</label>
  <input type="text" id="liquidityAmount" placeholder="e.g. 1.234" />

  <label>Gas Price (gwei):</label>
  <input type="text" id="gasPriceGwei" placeholder="e.g. 100" />

  <button id="removeBtn" disabled>Remove Liquidity</button>
  <div id="txHash"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // QUICK CHECK: what globals do we actually have?
      console.log('üîé window.ethers   =', window.ethers);
      console.log('üîé window.CoinbaseWalletSDK =', window.CoinbaseWalletSDK);
      console.log('üîé window.Web3Modal =', window.Web3Modal);

      const connectBtn = document.getElementById('connectBtn');
      const statusElem = document.getElementById('status');
      const removeBtn  = document.getElementById('removeBtn');
      const txHashElem = document.getElementById('txHash');

      // Setup Web3Modal with Coinbase only
      const providerOptions = {
        coinbasewallet: {
          package: window.CoinbaseWalletSDK,
          options: { appName: 'RemoveLiquidity DApp' }
        }
      };

      // IMPORTANT: we pull the constructor straight from window.Web3Modal
      const Web3Modal = window.Web3Modal;
      if (!Web3Modal) {
        statusElem.innerText = '‚ùå Web3Modal not found on window';
        return;
      }

      const web3Modal = new Web3Modal({
        cacheProvider: false,
        providerOptions
      });

      let provider, signer, contract;
      const CONTRACT_ADDRESS = '0xYourContractAddress';
      const CONTRACT_ABI     = ['function removeLiquidity(uint256 amount) external'];

      connectBtn.addEventListener('click', async () => {
        try {
          statusElem.innerText = '‚è≥ Opening wallet modal‚Ä¶';
          // THIS will show you ONLY Coinbase Wallet
          const externalProvider = await web3Modal.connect();
          provider = new ethers.providers.Web3Provider(externalProvider, 'any');
          signer   = provider.getSigner();
          contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

          const address = await signer.getAddress();
          statusElem.innerText = '‚úÖ Connected: ' + address;
          removeBtn.disabled = false;
        } catch (err) {
          console.error('Connect failed:', err);
          statusElem.innerText = '‚ùå Connect failed: ' + err.message;
        }
      });

      removeBtn.addEventListener('click', async () => {
        txHashElem.innerText = '';
        const amt  = document.getElementById('liquidityAmount').value.trim();
        const gwei = document.getElementById('gasPriceGwei').value.trim();
        if (!amt || isNaN(amt) || !gwei || isNaN(gwei)) {
          return alert('Enter valid numbers for both fields.');
        }
        try {
          const amount   = ethers.utils.parseUnits(amt, 18);
          const gasPrice = ethers.utils.parseUnits(gwei, 'gwei');
          console.log('‚è≥ Sending removeLiquidity', amount.toString(), 'gasPrice', gasPrice.toString());
          const tx = await contract.removeLiquidity(amount, { gasPrice });
          txHashElem.innerHTML = `Sent: <a href="https://etherscan.io/tx/${tx.hash}" target="_blank">${tx.hash}</a>`;
          await tx.wait();
          txHashElem.innerText += '\n‚úÖ Confirmed!';
        } catch (err) {
          console.error('removeLiquidity error:', err);
          txHashElem.innerText = 'Error: ' + (err.error?.message || err.message);
        }
      });
    });
  </script>
</body>
</html>
